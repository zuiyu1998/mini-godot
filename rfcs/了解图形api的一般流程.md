# 功能

- 了解图形 api 的一般流程
- 2024-7-23
- zuiyu1998

## 指南级别的解释

绘制图像的一般流程:

1 我们首先需要一个建立一个跨平台的模块，它能够在不同的操作系统+图形 API 环境当中，为我们创建这个基本的上下文。（可能是窗口，可能是全屏 FrameBuffer，也可能是 Off Screen Buffer）
2 然后，我们需要对平台的硬件能力进行查询和遍历，找到平台硬件（这里特指 GPU）所能够支持的画布格式，并且将 1 所创建的上下文的 FrameBuffer 格式指定为这个格式，GPU 才能够在上面作画。
3 CPU 使用平台所支持的图形 API 创建绘图所需要的各种 Heap/Buffer/View，生成资源描述子（RootSignature 或者 Descriptor），将各种资源的元数据（Meta Data)填入描述子，并传递给 GPU
4 CPU 根据场景描述信息进行顶点数据/索引/贴图/Shader 等的加载，并将其展开在 GPU 所能看到的（也就是在描述子里面登记过的）Buffer 当中
5 帧循环开始
6 CPU 读取用户输入（在之前的文章当中还未涉及），并更新用户可操作场景物体的位置和状态
7 CPU 执行游戏逻辑（包括动画、AI），并更新对应物体的位置和状态
8 CPU 进行物体的裁剪，找出需要绘制的物体（可见的物体）
9 CPU 将可见物体的位置和状态翻译成为常量，并把常量上传到 GPU 可见的常量缓冲区
10 CPU 生成记录 GPU 绘图指令的 Buffer （CommandList），并记录绘图指令
11 CPU 创建 Fence，以及相关的 Event，进行 CPU 和 GPU 之间的同步
12 CPU 提交记录了绘图指令的 Buffer（CommandList），然后等待 GPU 完成绘制（通过观察 Fence）
13 CPU 提交绘制结果，要求显示（Flip 或者 Present）
14 帧循环结束
